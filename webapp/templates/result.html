{% extends 'base.html' %}

{% block title %}Try-On Result - Virtual Fashion Try-On{% endblock %}

{% block content %}
<!-- Result Header Section -->
<section class="hero-section section" style="padding: 4rem 0 3rem;">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="text-center animate-on-scroll">
                    <h1 class="hero-title" style="font-size: 3rem; margin-bottom: 1rem;">Virtual Try-On Result</h1>
                    <p class="hero-subtitle" style="max-width: 700px; margin: 0 auto;">{{ result.clothing_prompt }}</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Result Display Section -->
<section class="try-on-section section section-light" style="padding: 4rem 0;">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="row g-4">
                    <!-- Original Image -->
                    <div class="col-md-6">
                        <div class="card h-100 animate-on-scroll result-card" style="padding: 0; border-radius: 24px; overflow: hidden;">
                            <div class="card-header" style="background: var(--gradient-primary); padding: 1.5rem; margin: 0;">
                                <h5 class="mb-0" style="color: white; font-weight: 600; text-align: center;">Original Photo</h5>
                            </div>
                            {% if result.original_image %}
                                <div class="result-image-wrapper" style="position: relative; height: 400px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: var(--bg-tertiary);">
                                    <img src="{{ result.original_image.url }}" alt="Original photo" 
                                         style="max-width: 100%; max-height: 100%; object-fit: contain; object-position: center; transition: transform 0.4s ease; display: block;">
                                    <div class="result-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, transparent 0%, rgba(139, 92, 246, 0.3) 100%); opacity: 0; transition: opacity 0.4s ease;"></div>
                                </div>
                            {% else %}
                                <div class="result-image-placeholder" style="height: 400px; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center;">
                                    <div class="text-center">
                                        <i class="bi bi-image" style="font-size: 4rem; color: var(--text-muted); opacity: 0.5; display: block; margin-bottom: 1rem;"></i>
                                        <p style="color: var(--text-muted);">Original image not available</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Result Image -->
                    <div class="col-md-6">
                        <div class="card h-100 animate-on-scroll result-card" style="padding: 0; border-radius: 24px; overflow: hidden;">
                            <div class="card-header" style="background: var(--gradient-primary); padding: 1.5rem; margin: 0;">
                                <h5 class="mb-0" style="color: white; font-weight: 600; text-align: center;">Virtual Try-On Result</h5>
                            </div>
                            {% if result.processing_status == 'completed' and result.result_image %}
                                <div class="result-image-wrapper" style="position: relative; height: 400px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: var(--bg-tertiary);">
                                    <img src="{{ result.result_image.url }}" alt="Try-on result" 
                                         style="max-width: 100%; max-height: 100%; object-fit: contain; object-position: center; transition: transform 0.4s ease; display: block;">
                                    <div class="result-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, transparent 0%, rgba(139, 92, 246, 0.3) 100%); opacity: 0; transition: opacity 0.4s ease;"></div>
                                </div>
                            {% elif result.processing_status == 'processing' %}
                                <div class="result-image-placeholder" style="height: 400px; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center;">
                                    <div class="text-center">
                                        <div class="spinner-border mb-3 pulse" style="color: var(--accent-primary);" role="status">
                                            <span class="visually-hidden">Processing...</span>
                                        </div>
                                        <p style="color: var(--text-secondary); font-weight: 500;">Processing your try-on request...</p>
                                        <small style="color: var(--text-muted);">This may take a few moments</small>
                                    </div>
                                </div>
                            {% elif result.processing_status == 'failed' %}
                                <div class="result-image-placeholder" style="height: 400px; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center;">
                                    <div class="alert alert-danger" role="alert" style="margin: 2rem; text-align: center;">
                                        <h6 class="alert-heading">Processing Failed</h6>
                                        <p class="mb-0">{{ result.error_message|default:"An error occurred during processing." }}</p>
                                    </div>
                                </div>
                            {% else %}
                                <div class="result-image-placeholder" style="height: 400px; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center;">
                                    <div class="text-center">
                                        <i class="bi bi-exclamation-circle" style="font-size: 4rem; color: var(--text-muted); opacity: 0.5; display: block; margin-bottom: 1rem;"></i>
                                        <p style="color: var(--text-muted);">Result not available</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Details and Actions Section -->
<section class="how-it-works-section section" style="padding: 4rem 0;">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="card animate-on-scroll">
                    <div class="card-body" style="padding: 2rem;">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h5 class="fw-bold mb-3" style="color: var(--text-primary);">Processing Details</h5>
                                <p class="mb-2" style="color: var(--text-secondary);"><strong>Status:</strong> 
                                    <span class="badge bg-{% if result.processing_status == 'completed' %}success{% elif result.processing_status == 'processing' %}warning{% else %}danger{% endif %}" style="padding: 0.5rem 1rem; border-radius: 12px; margin-left: 0.5rem;">
                                        {{ result.get_processing_status_display }}
                                    </span>
                                </p>
                                <p class="mb-2" style="color: var(--text-secondary);"><strong>Created:</strong> {{ result.created_at|date:"M d, Y H:i" }}</p>
                                <p class="mb-0" style="color: var(--text-secondary);"><strong>Description:</strong> {{ result.clothing_prompt }}</p>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <div class="d-grid gap-2" role="group">
                                    <a href="{% url 'index' %}" class="btn btn-primary" style="border-radius: 12px; padding: 12px 24px;">
                                        <i class="bi bi-arrow-left me-2"></i>Try Another Outfit
                                    </a>
                                    {% if result.processing_status == 'completed' and result.result_image %}
                                        <a href="{{ result.result_image.url }}" download class="btn btn-outline-success" style="border-radius: 12px; padding: 12px 24px;">
                                            <i class="bi bi-download me-2"></i>Download Result
                                        </a>
                                    {% endif %}
                                    {% if result.processing_status == 'processing' %}
                                        <button class="btn btn-outline-secondary" onclick="location.reload()" style="border-radius: 12px; padding: 12px 24px;">
                                            <i class="bi bi-arrow-clockwise me-2"></i>Refresh Status
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Auto-refresh for processing status -->
{% if result.processing_status == 'processing' %}
<script>
// Auto-refresh every 5 seconds if still processing with smooth transition
setTimeout(function() {
    document.body.style.opacity = '0.7';
    document.body.style.transform = 'translateY(10px)';
    setTimeout(() => {
        location.reload();
    }, 300);
}, 5000);
</script>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// Page entrance animation
document.addEventListener('DOMContentLoaded', function() {
    // Smooth page entrance animation
    document.body.style.opacity = '0';
    document.body.style.transform = 'translateY(20px)';
    document.body.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
    
    setTimeout(() => {
        document.body.style.opacity = '1';
        document.body.style.transform = 'translateY(0)';
    }, 100);
    
    // Enhanced scroll animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                setTimeout(() => {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }, index * 100);
            }
        });
    }, { threshold: 0.15, rootMargin: '0px 0px -80px 0px' });
    
    const animateElements = document.querySelectorAll('.animate-on-scroll');
    animateElements.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(50px)';
        el.style.transition = `all 0.8s cubic-bezier(0.4, 0, 0.2, 1) ${index * 0.1}s`;
        observer.observe(el);
    });
    
    // Enhanced hover effects for buttons with ripple effect
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px) scale(1.02)';
        });
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
        
        // Add ripple effect
        btn.addEventListener('click', function(e) {
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = (e.clientX - rect.left - size / 2) + 'px';
            ripple.style.top = (e.clientY - rect.top - size / 2) + 'px';
            ripple.classList.add('ripple');
            this.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
    });
    
    // Enhanced hover effects for result cards
    const resultCards = document.querySelectorAll('.result-card');
    resultCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.01)';
            this.style.boxShadow = '0 25px 50px var(--shadow-xl), var(--glow-primary)';
            this.style.borderColor = 'var(--accent-primary)';
            
            // Animate the image inside
            const img = this.querySelector('.result-image-wrapper img');
            const overlay = this.querySelector('.result-overlay');
            const placeholder = this.querySelector('.result-image-placeholder i');
            
            if (img) {
                img.style.transform = 'scale(1.05)';
            }
            if (overlay) {
                overlay.style.opacity = '1';
            }
            if (placeholder) {
                placeholder.style.transform = 'scale(1.1)';
                placeholder.style.color = 'var(--accent-primary)';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
            this.style.boxShadow = '0 8px 25px var(--shadow)';
            this.style.borderColor = 'var(--border-color)';
            
            const img = this.querySelector('.result-image-wrapper img');
            const overlay = this.querySelector('.result-overlay');
            const placeholder = this.querySelector('.result-image-placeholder i');
            
            if (img) {
                img.style.transform = 'scale(1)';
            }
            if (overlay) {
                overlay.style.opacity = '0';
            }
            if (placeholder) {
                placeholder.style.transform = 'scale(1)';
                placeholder.style.color = 'var(--text-muted)';
            }
        });
    });
    
    // Also add hover effects to the details card
    const detailsCard = document.querySelector('.card:not(.result-card)');
    if (detailsCard) {
        detailsCard.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px)';
            this.style.boxShadow = '0 20px 40px var(--shadow-lg)';
        });
        detailsCard.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 4px 25px var(--shadow)';
        });
    }
});
</script>

<style>
/* Additional styles for result page cards */
.result-card {
    will-change: transform;
    contain: layout style paint;
}

.result-card .result-image-wrapper img {
    backface-visibility: hidden;
    transform: translateZ(0);
}

/* Ripple effect for buttons */
.ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    transform: scale(0);
    animation: ripple-animation 0.6s linear;
    pointer-events: none;
}

@keyframes ripple-animation {
    to {
        transform: scale(4);
        opacity: 0;
    }
}

/* Enhanced card header effects */
.result-card .card-header {
    position: relative;
    overflow: hidden;
}

.result-card .card-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.8s ease;
}

.result-card:hover .card-header::before {
    left: 100%;
}

/* Smooth transitions for all elements */
.result-card * {
    transition: transform 0.4s ease, box-shadow 0.4s ease, opacity 0.4s ease;
}
</style>
{% endblock %}